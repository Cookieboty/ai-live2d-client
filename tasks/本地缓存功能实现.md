# 本地缓存功能实现

## 任务概述
在Electron应用中添加两个本地缓存功能：
1. 记住窗口位置（已实现）
2. 记住选择的角色模型（本次实现）

## 实现步骤

### 1. 创建缓存工具模块
- 新建`packages/renderer/src/utils/cache.ts`文件
- 实现`getCache`、`setCache`和`removeCache`函数，提供统一的缓存API
- 支持从Electron API和localStorage双重获取和保存数据
- 添加类型安全和错误处理机制

### 2. 更新ModelManager类
- 修改model.ts中的ModelManager类
- 将localStorage直接调用替换为新的缓存API
- 优化初始化逻辑，从缓存中加载上次使用的模型
- 在适当的位置保存模型选择到缓存中
- 错误处理和日志记录

### 3. 更新工具和窗口管理
- 修改tools.ts中的localStorage使用
- 更新widget.ts中的缓存相关代码
- 修复类型导出问题，确保隔离模块下正确导出类型
- 增加null检查和错误处理

### 4. 修复缓存实现问题
- 修复模型读取缓存切换功能
- 改进模型查找逻辑，确保能正确匹配缓存的模型名称
- 使用直接访问内部属性(`_modelId`和`_modelTexturesId`)而非setter方法，避免重复写入缓存
- 增加详细日志记录，方便调试
- 修复DOM元素null引用问题，增加安全检查
- 在初始化完成后同步缓存状态

### 5. 解决热重载兼容问题
- 确保在热重载过程中缓存状态能正确保持
- 修复热重载时可能出现的DOM元素null引用问题
- 改进缓存模块中的类型声明，确保与预加载脚本中的API定义一致

## 实现效果
- 用户选择的角色模型会被保存，应用重启后自动加载上次使用的模型
- 窗口位置也会被记住，应用重启后窗口会出现在上次的位置
- 缓存数据同时保存在Electron配置和localStorage中，提高稳定性

## 注意事项
- 修改过程中保持了与现有代码的兼容性
- 添加了适当的错误处理和日志记录
- 保证了类型安全
- 优化了异步逻辑处理
- 确保在热重载环境下也能正常工作
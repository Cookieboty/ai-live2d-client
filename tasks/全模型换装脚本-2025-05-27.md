# 全模型换装脚本开发

## 任务概述
基于现有的 `generate-model-list.js` 脚本，开发新的全模型换装脚本，用于生成支持换装功能的模型列表配置文件。

## 需求分析

### 模型结构分析
1. **moc目录结构**：所有模型都在 `packages/renderer/public/assets/models/moc/` 目录下，每个文件夹都是一个模型
2. **换装模型识别**：
   - 如果存在 `default.model.json` 或 `*.default.model.json`，则该模型支持换装功能
   - 其他 `*.model.json` 文件为该模型的不同装扮
3. **单一模型**：如果没有 `default.model.json`，且只有一个 `*.model.json` 或 `model.json`，则该模型无换装功能

### 特殊模型处理
- **22号和33号舰娘系列**：这两个系列的模型结构特殊，所有换装都在一个目录下
  - 22号舰娘：`22.2017.cba-normal` 目录，默认文件为 `22.default.model.json`
  - 33号舰娘：`33.2017.cba-normal` 目录，默认文件为 `model.default.json`

### 输出格式要求
1. 所有模型都包含默认模型读取路径
2. 当模型包含换装功能时，增加模型换装的路径数组
3. `message` 字段与模型保持同一层级，不要分开

## 实现步骤

### 1. 脚本设计
创建 `scripts/generate-costume-model-list.js` 脚本，包含以下功能：

#### 核心功能模块
- `hasValidModelFile()`: 检查目录是否包含有效的模型文件
- `getModelCostumes()`: 获取模型的所有换装配置
- `processSpecialModelGroups()`: 处理特殊模型组（22号和33号舰娘）
- `scanModels()`: 扫描moc目录并生成模型列表
- `generateConfig()`: 生成最终配置文件

#### 特殊模型组配置
```javascript
const SPECIAL_MODEL_GROUPS = {
  '22': {
    name: '22号舰娘',
    baseDir: '22.2017.cba-normal',
    defaultFile: '22.default.model.json'
  },
  '33': {
    name: '33号舰娘', 
    baseDir: '33.2017.cba-normal',
    defaultFile: 'model.default.json'
  }
};
```

### 2. 模型名称映射
建立详细的模型名称到显示名称的映射表，包括：
- 少女前线系列角色
- 常见动漫角色
- 特殊角色命名

### 3. 灵活的默认文件查找
实现多种默认文件名的查找逻辑：
- 指定的默认文件名
- `model.default.json`
- `{modelName}.default.model.json`
- `default.model.json`
- `index.json`
- 如果都没找到，使用第一个模型文件

## 实现结果

### 脚本执行结果
- **总模型数量**：103个模型
- **支持换装的模型**：3个
  - 22号舰娘：13个换装
  - 33号舰娘：13个换装
  - makoto0：1个换装

### 生成的配置文件格式
```json
{
  "models": [
    {
      "name": "22",
      "path": "22.2017.cba-normal/22.default.model.json",
      "message": "22号舰娘",
      "costumes": [
        "22.2017.cba-normal/22.2017.cba-normal.model.json",
        "22.2017.cba-normal/22.2017.newyear.model.json",
        // ... 更多换装
      ]
    },
    {
      "name": "miku",
      "path": "miku/miku.model.json",
      "message": "初音未来"
      // 无换装功能，不包含costumes字段
    }
  ]
}
```

### 22号舰娘换装详情
- 默认：`22.2017.cba-normal/22.default.model.json`
- 换装包括：
  - 常规服装 (cba-normal)
  - 新年服装 (newyear)
  - 学校服装 (school)
  - 夏季服装 (summer.normal.1/2)
  - 社团活动服装 (tomo-bukatsu.high/low)
  - 山谷服装 (valley)
  - 情人节服装 (vdays)
  - 恋人服装 (lover)
  - 春季服装 (spring)
  - 圣诞服装 (xmas.1/2)

### 33号舰娘换装详情
- 默认：`33.2017.cba-normal/model.default.json`
- 换装包括类似的主题服装，但文件命名格式不同

## 技术特点

### 1. 智能模型识别
- 自动识别模型目录结构
- 灵活处理不同的文件命名方式
- 特殊模型组的专门处理逻辑

### 2. 错误处理
- 跳过无效的模型目录
- 处理文件访问异常
- 提供详细的日志输出

### 3. 可扩展性
- 易于添加新的特殊模型组
- 模型名称映射表可轻松扩展
- 支持多种默认文件命名方式

## 文件输出
- **配置文件**：`packages/renderer/public/assets/costume_model_list.json`
- **脚本文件**：`scripts/generate-costume-model-list.js`

## 使用方法
```bash
node scripts/generate-costume-model-list.js
```

## 后续优化建议

### 1. 功能增强
- 支持更多特殊模型组的自动识别
- 添加模型预览图片路径配置
- 支持模型分类和标签系统

### 2. 性能优化
- 缓存模型扫描结果
- 并行处理模型目录
- 增量更新机制

### 3. 配置管理
- 支持配置文件热重载
- 提供配置验证功能
- 添加配置文件版本管理

## 总结
成功开发了全模型换装脚本，实现了以下目标：
1. ✅ 正确识别所有模型的换装功能
2. ✅ 生成符合要求的JSON配置文件
3. ✅ 特殊处理22号和33号舰娘系列
4. ✅ 提供详细的模型信息和换装路径
5. ✅ 支持灵活的文件命名方式
6. ✅ 包含完整的错误处理和日志输出

该脚本为Live2D看板娘应用的换装功能提供了完整的模型配置支持。 
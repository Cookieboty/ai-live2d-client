# 模型换装脚本修复

## 任务概述
修复 `generate-costume-model-list.js` 脚本中 `33.2018.lover` 模型换装识别问题。

## 问题描述
用户发现 `33.2018.lover` 模型明明有换装文件，但在生成的 `costume_model_list.json` 中没有 `costumes` 字段，被识别为无换装模型。

## 问题分析

### 1. 初始问题
脚本的模型文件过滤逻辑有问题：
```javascript
const modelFiles = files.filter(file =>
  file.endsWith('.model.json') ||
  file === 'model.json' ||
  file === 'index.json'
);
```

这个过滤条件只匹配以 `.model.json` 结尾的文件，但是 `33.2018.lover` 目录中的大部分换装文件都是以 `.json` 结尾的（如 `model.default.json`, `model.2017.newyear.json` 等）。

### 2. 调试发现
通过添加调试输出发现：
- `33.2018.lover` 目录中有17个文件
- 但脚本只识别了 `33.2018.lover.model.json` 这一个模型文件
- 其他的 `.json` 文件都被忽略了

### 3. 进一步问题
修复第一个问题后，发现脚本错误地将 `*.physics.json` 和 `*.pose.json` 等配置文件也当作了模型文件。

## 解决方案

### 1. 扩展模型文件识别范围
修改过滤逻辑，包含所有 `.json` 文件：
```javascript
const modelFiles = files.filter(file =>
  file.endsWith('.model.json') ||
  file.endsWith('.json') ||
  file === 'model.json' ||
  file === 'index.json'
);
```

### 2. 排除配置文件
进一步完善过滤逻辑，排除非模型的配置文件：
```javascript
const modelFiles = files.filter(file => {
  // 只包含模型文件
  if (file.endsWith('.model.json') || file === 'model.json' || file === 'index.json') {
    return true;
  }
  
  // 对于其他.json文件，排除配置文件
  if (file.endsWith('.json')) {
    const excludePatterns = [
      '.physics.json', '.pose.json', '.settings.json',
      'physics.json', 'pose.json', 'settings.json',
      'params.json', 'textures_order.json'
    ];
    
    return !excludePatterns.some(pattern => 
      file.endsWith(pattern) || file.includes(pattern.replace('.json', '.'))
    );
  }
  
  return false;
});
```

### 3. 同步更新 hasValidModelFile 函数
确保两个函数使用相同的过滤逻辑。

## 修复结果

### 修复前
- `33.2018.lover` 被识别为无换装模型
- 总共只有3个模型支持换装功能

### 修复后
- `33.2018.lover` 正确识别为有13个换装的模型
- 总共有60个模型支持换装功能（排除配置文件后的正确数量）

### 33.2018.lover 换装详情
```
33.2018.lover (33号舰娘):
  默认: 33.2018.lover/model.default.json
  换装1: 33.2018.lover/33.2018.lover.model.json
  换装2: 33.2018.lover/model.2016.xmas.1.json
  换装3: 33.2018.lover/model.2016.xmas.2.json
  换装4: 33.2018.lover/model.2017.cba-normal.json
  换装5: 33.2018.lover/model.2017.newyear.json
  换装6: 33.2018.lover/model.2017.school.json
  换装7: 33.2018.lover/model.2017.summer.normal.1.json
  换装8: 33.2018.lover/model.2017.summer.normal.2.json
  换装9: 33.2018.lover/model.2017.tomo-bukatsu.high.json
  换装10: 33.2018.lover/model.2017.tomo-bukatsu.low.json
  换装11: 33.2018.lover/model.2017.valley.json
  换装12: 33.2018.lover/model.2017.vdays.json
  换装13: 33.2018.lover/model.2018.spring.json
```

## 技术要点

### 1. 文件过滤逻辑
- 包含所有真正的模型文件（`.model.json`, `model.json`, `index.json`, 以及特定命名的 `.json` 文件）
- 排除配置文件（`physics.json`, `pose.json`, `settings.json`, `params.json`, `textures_order.json`）

### 2. 默认文件识别
脚本能正确识别 `model.default.json` 作为默认模型文件。

### 3. 换装路径生成
正确生成所有换装文件的相对路径。

## 影响范围
- 修复了所有类似命名模式的模型换装识别问题
- 提高了模型配置文件的准确性
- 为Live2D看板娘应用提供了更完整的换装功能支持

## 总结
成功修复了 `33.2018.lover` 模型换装识别问题，脚本现在能够：
1. ✅ 正确识别所有模型文件格式
2. ✅ 排除非模型的配置文件
3. ✅ 准确生成换装配置
4. ✅ 支持多种文件命名模式

该修复确保了Live2D看板娘应用能够正确加载和切换 `33.2018.lover` 模型的所有换装。 
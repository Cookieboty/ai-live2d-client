# 工具栏层级优化 - 2025-05-30

## 问题描述
用户反馈工具栏后面三个按钮（拍照、置顶、关闭）移动鼠标上去时不能正常hover，只有在右侧边缘才有hover效果，怀疑是有层级遮挡问题。

## 问题分析（更新）
经过深入分析发现，问题不是z-index层级问题，而是**拖拽区域干扰**：

1. **根本原因**：`useWindowDrag` hook 为Live2D canvas设置了 `webkitAppRegion = 'drag'`
2. **影响范围**：整个canvas区域变成拖拽区域，干扰了鼠标事件的正常传递
3. **表现症状**：工具栏按钮只有在最右侧边缘（不被拖拽区域覆盖的部分）才能正常hover
4. **错误方向**：之前尝试的z-index调整完全是错误的方向

## 正确解决方案

### 1. 为工具栏设置拖拽排除区域
- 在工具栏容器添加 `-webkit-app-region: no-drag`
- 在工具栏按钮添加 `-webkit-app-region: no-drag`
- 确保工具栏区域不被拖拽功能干扰

### 2. 还原错误的z-index修改
- 还原工具栏z-index到合理值（10000）
- 还原按钮z-index到1
- 还原图标z-index到1
- 移除所有不必要的!important声明

### 3. 保持原有的层级结构
- MessageBubble z-index: 10000
- 工具栏 z-index: 10000
- Live2D canvas z-index: 1000
- Live2D容器 z-index: 1

## 修改文件列表

### packages/renderer/src/components/ToolBar/style.module.css
- 添加 `-webkit-app-region: no-drag` 到工具栏容器和按钮
- 还原z-index到合理值
- 移除错误的!important声明
- 简化hover效果

## 技术要点

### Electron拖拽区域机制
- `webkitAppRegion = 'drag'` 会让整个区域变成拖拽区域
- 拖拽区域会拦截鼠标事件，导致hover和click失效
- `webkitAppRegion = 'no-drag'` 可以排除特定区域不被拖拽

### 正确的层级规划
```
MessageBubble: 10000
工具栏: 10000
Live2D canvas: 1000
Live2D容器: 1
```

## 预期效果
1. 工具栏所有按钮的hover效果正常工作
2. 点击事件正常响应
3. 拖拽功能不影响工具栏交互
4. 保持原有的视觉层级

## 经验教训
1. **问题诊断要准确**：不要被表面现象误导，要深入分析根本原因
2. **Electron特性理解**：需要了解webkitAppRegion的工作机制
3. **避免过度优化**：z-index不是万能解决方案
4. **测试验证重要**：每次修改都要验证是否真正解决问题

## 状态
✅ 已完成（正确方案）- 2025-05-30 